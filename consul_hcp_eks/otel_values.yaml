config:
  receivers:
      prometheus:
        config:
          scrape_configs:
            - job_name: 'otel-collector-pods'
              scrape_interval: 5s
              kubernetes_sd_configs:
                - role: pod
              relabel_configs:
                - action: labelmap
                  regex: __meta_kubernetes_pod_label_(.+)
                - source_labels: [__meta_kubernetes_namespace]
                  action: replace
                  target_label: namespace
                - source_labels: [__meta_kubernetes_pod_name]
                  action: replace
                  target_label: pod
                - source_labels: [__meta_kubernetes_pod_annotation_honeycomb_io_metrics_path]
                  action: replace
                  target_label: __metrics_path__
                  regex: (.+)
                - source_labels: [__address__, __meta_kubernetes_pod_annotation_honeycomb_io_scrape_port]
                  action: replace
                  regex: ([^:]+)(?::\d+)?;(\d+)
                  replacement: $1:$2
                  target_label: __address__
                - source_labels: [__meta_kubernetes_pod_annotation_honeycomb_io_metrics]
                  action: keep
                  regex: true
  service:
    pipelines:
      metrics:
        receivers:
          - prometheus
        exporters:
          - otlp

podAnnotations:
  consul.hashicorp.com/connect-inject: 'false'
  consul.hashicorp.com/transparent-proxy: 'false'